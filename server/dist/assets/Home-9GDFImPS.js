import{k as O,r as x,m as Q,j as e,I as j,u as T,i as k,t as A,n as y,l as _,o as K}from"./index-wLWO9-d2.js";import{I as L,D as W,M as G,a as J,b as V,c as M,u as X}from"./useResponsiveWidth-huLhTKBL.js";import{E as Z}from"./Empty-ltZlBdUA.js";import{u as R,O as I,T as Y,a as ee,M as se}from"./MemoView-Hb4REtig.js";import{S as te}from"./SearchBar-9pRpIKu1.js";import{u as z,g as E}from"./useDebounce-KloUpVAw.js";import{g as $,D as ae}from"./CommonDialog-ZOWzLRrT.js";import{I as D,u as re}from"./useLoading-1GM5JUMl.js";import{B as b,L as le}from"./Button-Y8r740D0.js";import{L as F}from"./VisibilityIcon-nq_zBLTG.js";import{D as ne,M as ie}from"./MobileHeader-d_EUlUPT.js";import{u as oe,M as ce}from"./useFilterWithUrlParams-ebCQAYQq.js";import{R as me}from"./common-logcmh1j.js";import"./useControlled-c04xw6hS.js";import"./useLocalStorage-fn64V-Iu.js";import"./Typography-Ugz7CGU8.js";import"./Select-Gl6RUiyX.js";import"./createSvgIcon-LnoQSaos.js";import"./Checkbox-4xG-yJfH.js";import"./Link-B2ydOwab.js";import"./ResourceIcon-rz_9chuf.js";import"./Divider-PmcpRuGM.js";import"./last-IOi7af79.js";const de=r=>{const{user:s}=r,t=R(),g=O(),[n,m]=x.useState(0),[i,f]=x.useState(!1),o=Math.ceil((Date.now()-s.createTime.getTime())/864e5),d=Object.values(g.getState().memoMapById),h=t.state.tags.length;return x.useEffect(()=>{d.length!==0&&(async()=>{f(!0);const{stats:c}=await Q.getUserMemosStats({name:s.name,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone});f(!1),m(Object.values(c).reduce((l,u)=>l+u,0))})()},[d.length,s.name]),e.jsxs("div",{className:"w-full border mt-2 py-2 px-3 rounded-md space-y-0.5 text-gray-500 dark:text-gray-400 bg-zinc-50 dark:bg-zinc-900 dark:border-zinc-800",children:[e.jsx("p",{className:"text-sm font-medium",children:"Statistics"}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex justify-start items-center",children:[e.jsx(j.CalendarDays,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-base sm:text-sm",children:"Days"})]}),e.jsx("span",{className:"font-mono",children:o})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex justify-start items-center",children:[e.jsx(j.Library,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-base sm:text-sm",children:"Memos"})]}),i?e.jsx(j.Loader,{className:"animate-spin w-4 h-auto text-gray-400"}):e.jsx("span",{className:"font-mono",children:n})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex justify-start items-center",children:[e.jsx(j.Hash,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-base sm:text-sm",children:"Tags"})]}),e.jsx("span",{className:"font-mono",children:h})]})]})};var B={};Object.defineProperty(B,"__esModule",{value:!0});var ue=x,xe=function(r,s){return typeof s=="boolean"?s:!r},ge=function(r){return ue.useReducer(xe,r)},fe=B.default=ge;const C=r=>{const s=`#${r}`.match(Y);return!(!s||s[1]!==r)},he=r=>{const{destroy:s}=r,t=T(),g=k(),n=R(),[m,i]=x.useState(""),[f,o]=x.useState([]),[d,h]=x.useState(!1),c=n.state.tags,l=f.filter(a=>!c.includes(a));x.useEffect(()=>{A.getTagSuggestions({user:g.name}).then(({tags:a})=>{o(a.filter(S=>C(S)))})},[c]);const u=a=>{a.key==="Enter"&&v()},p=a=>{const S=a.target.value;i(S.trim())},N=async a=>{await n.upsertTag(a)},w=()=>{h(a=>!a)},v=async()=>{if(!C(m)){y.error(t("tag-list.invalid-tag-name"));return}try{await n.upsertTag(m),i("")}catch(a){console.error(a),y.error(a.response.data.message)}},H=async a=>{await n.deleteTag(a)},q=async()=>{for(const a of f)C(a)&&await n.upsertTag(a)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dialog-header-container",children:[e.jsx("p",{className:"title-text",children:t("tag-list.create-tag")}),e.jsx(L,{size:"sm",onClick:()=>s(),children:e.jsx(j.X,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"dialog-content-container !w-80",children:[e.jsx(D,{className:"mb-2",size:"md",placeholder:t("tag-list.tag-name"),value:m,onChange:p,onKeyDown:u,fullWidth:!0,startDecorator:e.jsx(j.Hash,{className:"w-4 h-auto"}),endDecorator:e.jsx(j.Check,{onClick:v,className:"w-4 h-auto cursor-pointer hover:opacity-80"})}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"w-full mt-2 mb-1 text-sm text-gray-400",children:t("tag-list.all-tags")}),e.jsx("div",{className:"w-full flex flex-row justify-start items-start flex-wrap",children:Array.from(c).sort().map(a=>e.jsx(I,{className:"max-w-[120px] text-sm mr-2 mt-1 font-mono cursor-pointer dark:text-gray-300 hover:opacity-60 hover:line-through",children:e.jsxs("span",{className:"w-full",onClick:()=>H(a),children:["#",a]})},a))})]}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 mb-1 text-sm w-full flex flex-row justify-start items-center",children:[e.jsx("span",{className:"text-gray-400 mr-2",children:t("tag-list.tag-suggestions")}),e.jsx("span",{className:"text-xs border border-gray-200 rounded-md px-1 leading-5 cursor-pointer text-gray-600 hover:shadow dark:border-zinc-700 dark:text-gray-400",onClick:w,children:t(d?"tag-list.hide":"tag-list.show")})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex flex-row justify-start items-start flex-wrap mb-2",children:l.map(a=>e.jsx(I,{className:"max-w-[120px] text-sm mr-2 mt-1 font-mono cursor-pointer dark:text-gray-300 hover:opacity-60",children:e.jsxs("span",{className:"w-full",onClick:()=>N(a),children:["#",a]})},a))}),e.jsx(b,{size:"sm",variant:"outlined",onClick:q,children:t("tag-list.save-all")})]})]})]})]})};function je(){$({className:"create-tag-dialog",dialogName:"create-tag-dialog"},he)}const pe=r=>{const{tag:s,destroy:t}=r,g=T(),n=z(),m=k(),[i,f]=x.useState(s),o=re(!1),d=c=>{f(c.target.value.trim())},h=async()=>{if(!i||i.includes(" ")){y.error("Tag name cannot be empty or contain spaces");return}if(i===s){y.error("New name cannot be the same as the old name");return}try{await A.renameTag({user:m.name,oldName:s,newName:i}),y.success("Rename tag successfully"),n.setTagFilter(i)}catch(c){console.error(c),y.error(c.details)}t()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dialog-header-container",children:[e.jsx("p",{className:"title-text",children:"Rename tag"}),e.jsx(L,{size:"sm",onClick:()=>t(),children:e.jsx(j.X,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"dialog-content-container max-w-xs",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[e.jsxs("div",{className:"relative w-full mb-2 flex flex-row justify-start items-center space-x-2",children:[e.jsx("span",{className:"w-20 text-sm whitespace-nowrap shrink-0 text-right",children:"Old Name"}),e.jsx(D,{className:"w-full",readOnly:!0,disabled:!0,type:"text",placeholder:"A new tag name",size:"md",value:s})]}),e.jsxs("div",{className:"relative w-full mb-2 flex flex-row justify-start items-center space-x-2",children:[e.jsx("span",{className:"w-20 text-sm whitespace-nowrap shrink-0 text-right",children:"New Name"}),e.jsx(D,{className:"w-full",type:"text",placeholder:"A new tag name",size:"md",value:i,onChange:d})]}),e.jsxs(le,{className:"!leading-5",size:"sm",marker:"disc",children:[e.jsx(F,{children:"All your memos with this tag will be updated."}),e.jsx(F,{children:"If the number of related memos is large, it will take longer and the server load will become higher."})]})]}),e.jsxs("div",{className:"w-full flex flex-row justify-end items-center mt-2 space-x-2",children:[e.jsx(b,{color:"neutral",variant:"plain",disabled:o.isLoading,loading:o.isLoading,onClick:t,children:g("common.cancel")}),e.jsx(b,{color:"primary",disabled:o.isLoading,loading:o.isLoading,onClick:h,children:g("common.confirm")})]})]})]})};function we(r){$({className:"rename-tag-dialog",dialogName:"rename-tag-dialog"},pe,r)}const ye=()=>{const r=T(),s=z(),t=R(),g=_(),n=t.state.tags,m=s.state,[i,f]=x.useState([]);return x.useEffect(()=>{t.fetchTags()},[g.size()]),x.useEffect(()=>{const o=Array.from(n).sort(),d={subTags:[]};for(const h of o){const c=h.split("/");let l=d,u="";for(let p=0;p<c.length;p++){const N=c[p];p===0?u+=N:u+="/"+N;let w=null;for(const v of l.subTags)if(v.text===u){w=v;break}w||(w={key:N,text:u,subTags:[]},l.subTags.push(w)),l=w}}f(d.subTags)},[n]),e.jsxs("div",{className:"flex flex-col justify-start items-start w-full mt-3 px-1 h-auto shrink-0 flex-nowrap hide-scrollbar",children:[e.jsxs("div",{className:"flex flex-row justify-start items-center w-full",children:[e.jsx("span",{className:"text-sm leading-6 font-mono text-gray-400",children:r("common.tags")}),e.jsx("button",{onClick:()=>je(),className:"flex flex-col justify-center items-center w-5 h-5 bg-gray-200 dark:bg-zinc-800 rounded ml-2 hover:shadow",children:e.jsx(j.Plus,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx("div",{className:"flex flex-col justify-start items-start relative w-full h-auto flex-nowrap",children:i.map((o,d)=>e.jsx(P,{tag:o,tagQuery:m.tag},o.text+"-"+d))})]})},P=r=>{const s=z(),{tag:t,tagQuery:g}=r,n=g===t.text,m=t.subTags.length>0,[i,f]=fe(!1),o=()=>{n?s.setTagFilter(void 0):s.setTagFilter(t.text)},d=h=>{h.stopPropagation(),f()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative group flex flex-row justify-between items-center w-full h-8 py-0 mt-px first:mt-1 rounded-lg text-base sm:text-sm cursor-pointer select-none shrink-0 hover:opacity-80",children:[e.jsxs("div",{className:`flex flex-row justify-start items-center truncate shrink leading-5 mr-1 text-gray-600 dark:text-gray-400 ${n&&"!text-blue-600"}`,children:[e.jsxs(W,{children:[e.jsx(G,{slots:{root:"div"},children:e.jsx("div",{className:"shrink-0",children:e.jsx(j.Hash,{className:"w-4 h-auto shrink-0 opacity-60 mr-1"})})}),e.jsx(J,{size:"sm",placement:"bottom-start",children:e.jsx(V,{onClick:()=>we({tag:t.text}),children:"Rename"})})]}),e.jsx("span",{className:"truncate",onClick:o,children:t.key})]}),e.jsx("div",{className:"flex flex-row justify-end items-center",children:m?e.jsx("span",{className:`flex flex-row justify-center items-center w-6 h-6 shrink-0 transition-all rotate-0 ${i&&"rotate-90"}`,onClick:d,children:e.jsx(j.ChevronRight,{className:"w-5 h-5 opacity-40 dark:text-gray-400"})}):null})]}),m?e.jsx("div",{className:`w-[calc(100%-0.5rem)] flex flex-col justify-start items-start h-auto ml-2 pl-2 border-l-2 border-l-gray-200 dark:border-l-zinc-800 ${!i&&"!hidden"}`,children:t.subTags.map((h,c)=>e.jsx(P,{tag:h,tagQuery:g},h.text+"-"+c))}):null]})},U=r=>{const s=k();return e.jsxs("aside",{className:M("relative w-full h-auto max-h-screen overflow-auto hide-scrollbar flex flex-col justify-start items-start",r.className),children:[e.jsx(te,{}),e.jsx(de,{user:s}),e.jsx(ye,{})]})},Ne=()=>{const r=K(),[s,t]=x.useState(!1);x.useEffect(()=>{t(!1)},[r.pathname]);const g=n=>m=>{m.type==="keydown"&&(m.key==="Tab"||m.key==="Shift")||t(n)};return e.jsxs(e.Fragment,{children:[e.jsx(L,{onClick:g(!0),children:e.jsx(j.Search,{className:"w-5 h-auto dark:text-gray-400"})}),e.jsx(ne,{anchor:"right",size:"sm",open:s,onClose:g(!1),children:e.jsx("div",{className:"w-full h-full px-5 bg-zinc-100 dark:bg-zinc-900",children:e.jsx(U,{className:"py-4"})})})]})},Qe=()=>{const r=T(),{md:s}=X(),t=k(),g=O(),n=_(),[m,i]=x.useState(!0),f=x.useRef(void 0),{tag:o,text:d}=oe(),h=n.value.filter(l=>l.rowStatus===me.ACTIVE).sort((l,u)=>E(u.displayTime)-E(l.displayTime)).sort((l,u)=>Number(u.pinned)-Number(l.pinned));x.useEffect(()=>{f.current=void 0,n.reset(),c()},[o,d]);const c=async()=>{const l=[`creator == "${t.name}"`,'row_status == "NORMAL"',"order_by_pinned == true"],u=[];o&&u.push(JSON.stringify(`#${o}`)),d&&u.push(JSON.stringify(d)),u.length>0&&l.push(`content_search == [${u.join(", ")}]`),i(!0);const p=await g.fetchMemos({pageSize:ae,filter:l.join(" && "),pageToken:f.current});i(!1),f.current=p.nextPageToken};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!s&&e.jsx(ie,{children:e.jsx(Ne,{})}),e.jsxs("div",{className:M("w-full flex flex-row justify-start items-start px-4 sm:px-6 gap-4"),children:[e.jsxs("div",{className:M(s?"w-[calc(100%-15rem)]":"w-full"),children:[e.jsx(ee,{className:"mb-2",cacheKey:"home-memo-editor"}),e.jsxs("div",{className:"flex flex-col justify-start items-start w-full max-w-full pb-28",children:[e.jsx(ce,{className:"px-2 pb-2"}),h.map(l=>e.jsx(se,{memo:l,showVisibility:!0,showPinned:!0},`${l.id}-${l.updateTime}`)),m?e.jsxs("div",{className:"flex flex-row justify-center items-center w-full my-4 text-gray-400",children:[e.jsx(j.Loader,{className:"w-4 h-auto animate-spin mr-1"}),e.jsx("p",{className:"text-sm italic",children:r("memo.fetching-data")})]}):f.current?e.jsx("div",{className:"w-full flex flex-row justify-center items-center my-4",children:e.jsx(b,{variant:"plain",endDecorator:e.jsx(j.ArrowDown,{className:"w-5 h-auto"}),onClick:c,children:r("memo.fetch-more")})}):h.length===0&&e.jsxs("div",{className:"w-full mt-12 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(Z,{}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:r("message.no-data")})]})]})]}),s&&e.jsx("div",{className:"sticky top-0 left-0 shrink-0 -mt-6 w-56 h-full",children:e.jsx(U,{className:"py-6"})})]})]})};export{Qe as default};
