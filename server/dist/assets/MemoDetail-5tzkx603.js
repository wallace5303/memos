import{u as B,p as O,a as R,i as U,k as F,c as V,r as c,M as g,q as N,n as v,j as e,d as M,I as r,V as h}from"./index-wLWO9-d2.js";import{c as L}from"./common-logcmh1j.js";import{a as D,M as P,b as z}from"./useDebounce-KloUpVAw.js";import{b as _,s as A,M as K,a as q,c as H}from"./MemoView-Hb4REtig.js";import{M as W}from"./MobileHeader-d_EUlUPT.js";import{U as G,T as u,I as f}from"./useResponsiveWidth-huLhTKBL.js";import{V as J,c as Q}from"./VisibilityIcon-nq_zBLTG.js";import{S as X,O as Y}from"./Select-Gl6RUiyX.js";import"./ResourceIcon-rz_9chuf.js";import"./CommonDialog-ZOWzLRrT.js";import"./last-IOi7af79.js";import"./Button-Y8r740D0.js";import"./useLoading-1GM5JUMl.js";import"./Divider-PmcpRuGM.js";import"./Checkbox-4xG-yJfH.js";import"./createSvgIcon-LnoQSaos.js";import"./Typography-Ugz7CGU8.js";import"./useControlled-c04xw6hS.js";import"./useLocalStorage-fn64V-Iu.js";import"./Link-B2ydOwab.js";const we=()=>{const o=B(),b=O(),y=R(),l=U(),a=F(),C=V(),[i,k]=c.useState(),n=b.memoName,t=a.getMemoByName(n||""),[d,j]=c.useState(void 0),I=(t==null?void 0:t.relations.filter(s=>s.type===g.REFERENCE))||[],w=(t==null?void 0:t.relations.filter(s=>s.relatedMemoId===(t==null?void 0:t.id)&&s.type===g.COMMENT))||[],x=w.map(s=>a.getMemoById(s.memoId)).filter(s=>s),p=(t==null?void 0:t.creatorId)!==(l==null?void 0:l.id);if(c.useEffect(()=>{n?a.getOrFetchMemoByName(n).then(async s=>{const m=await C.getOrFetchUserByUsername(N(s.creator));k(m)}).catch(s=>{v.error(s.details),y("/403")}):y("/404")},[n]),c.useEffect(()=>{t&&(async()=>(t.parentId?a.getOrFetchMemoById(t.parentId).then(s=>{j(s)}):j(void 0),await Promise.all(w.map(s=>a.getOrFetchMemoById(s.memoId)))))()},[t]),!t)return null;const T=async s=>{await a.updateMemo({id:t.id,visibility:s},["visibility"])},E=()=>{H({memoId:t.id,cacheKey:`${t.id}-${t.updateTime}`})},S=()=>{L(`${window.location.origin}/m/${t.name}`),v.success(o("message.succeed-copy-link"))},$=async s=>{await a.getOrFetchMemoById(s),await a.getOrFetchMemoById(t.id,{skipCache:!0})};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[e.jsx(W,{}),e.jsxs("div",{className:"w-full px-4 sm:px-6",children:[e.jsxs("div",{className:"relative flex-grow w-full min-h-full flex flex-col justify-start items-start border dark:border-zinc-700 bg-white dark:bg-zinc-800 shadow hover:shadow-xl transition-all p-4 pb-3 rounded-lg",children:[e.jsx("div",{className:"mb-3",children:e.jsx(M,{to:`/u/${encodeURIComponent(N(t.creator))}`,unstable_viewTransition:!0,children:e.jsxs("span",{className:"w-full flex flex-row justify-start items-center",children:[e.jsx(G,{className:"!w-10 !h-10 mr-2",avatarUrl:i==null?void 0:i.avatarUrl}),e.jsxs("div",{className:"flex flex-col justify-start items-start gap-1",children:[e.jsx("span",{className:"text-lg leading-none text-gray-600 max-w-[8em] truncate dark:text-gray-400",children:i==null?void 0:i.nickname}),e.jsx("span",{className:"text-sm leading-none text-gray-400 select-none",children:D(t.displayTime)})]})]})})}),d&&e.jsx("div",{className:"w-auto mb-2",children:e.jsxs(M,{className:"px-3 py-1 border rounded-lg max-w-xs w-auto text-sm flex flex-row justify-start items-center flex-nowrap text-gray-600 dark:text-gray-400 dark:border-gray-500 hover:shadow hover:opacity-80",to:`/m/${d.name}`,unstable_viewTransition:!0,children:[e.jsx(r.ArrowUpLeftFromCircle,{className:"w-4 h-auto shrink-0 opacity-60 mr-2"}),e.jsx("span",{className:"truncate",children:d.content})]})}),e.jsx(P,{memoId:t.id,content:t.content,readonly:p},`${t.id}-${t.updateTime}`),e.jsx(z,{resources:t.resources}),e.jsx(_,{memo:t,relationList:I}),e.jsxs("div",{className:"w-full mt-3 flex flex-row justify-between items-center gap-2",children:[e.jsx("div",{className:"flex flex-row justify-start items-center",children:!p&&e.jsx(X,{className:"w-auto text-sm",variant:"plain",value:t.visibility,startDecorator:e.jsx(J,{visibility:t.visibility}),onChange:(s,m)=>{m&&T(m)},children:[h.PRIVATE,h.PROTECTED,h.PUBLIC].map(s=>e.jsx(Y,{value:s,className:"whitespace-nowrap",children:o(`memo.visibility.${Q(s).toLowerCase()}`)},s))})}),e.jsxs("div",{className:"flex flex-row sm:justify-end items-center",children:[!p&&e.jsx(u,{title:"Edit",placement:"top",children:e.jsx(f,{size:"sm",onClick:E,children:e.jsx(r.Edit3,{className:"w-4 h-auto text-gray-600 dark:text-gray-400"})})}),e.jsx(u,{title:"Copy link",placement:"top",children:e.jsx(f,{size:"sm",onClick:S,children:e.jsx(r.Link,{className:"w-4 h-auto text-gray-600 dark:text-gray-400"})})}),e.jsx(u,{title:"Share",placement:"top",children:e.jsx(f,{size:"sm",onClick:()=>A(t),children:e.jsx(r.Share,{className:"w-4 h-auto text-gray-600 dark:text-gray-400"})})})]})]})]}),e.jsx("div",{className:"pt-8 pb-16 w-full",children:e.jsxs("div",{className:"relative mx-auto flex-grow w-full min-h-full flex flex-col justify-start items-start gap-y-1",children:[x.length===0?e.jsxs("div",{className:"w-full flex flex-col justify-center items-center py-6 mb-2",children:[e.jsx(r.MessageCircle,{strokeWidth:1,className:"w-8 h-auto text-gray-400"}),e.jsx("p",{className:"text-gray-400 italic text-sm",children:o("memo.comment.no-comment")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center pl-3 mb-3",children:[e.jsx(r.MessageCircle,{className:"w-5 h-auto text-gray-400 mr-1"}),e.jsx("span",{className:"text-gray-400 text-sm",children:o("memo.comment.self")}),e.jsxs("span",{className:"text-gray-400 text-sm ml-0.5",children:["(",x.length,")"]})]}),x.map(s=>e.jsx(K,{memo:s,showCreator:!0},`${t.id}-${t.displayTime}`))]}),l&&e.jsx(q,{cacheKey:`comment-editor-${t.id}`,parentMemoId:t.id,onConfirm:$},t.id)]})})]})]})};export{we as default};
