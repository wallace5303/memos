import{aD as N,aE as v,aF as b,aG as k,aH as D,ay as T,aI as R,u as I,r as h,k as M,ab as w,j as e,I as p,au as S,d as E}from"./index-wLWO9-d2.js";import{s as F}from"./CommonDialog-ZOWzLRrT.js";import{E as C}from"./Empty-ltZlBdUA.js";import{M as L}from"./MobileHeader-d_EUlUPT.js";import{t as _,R as y}from"./ResourceIcon-rz_9chuf.js";import{u as z,I as A}from"./useLoading-1GM5JUMl.js";import{D as B}from"./Divider-PmcpRuGM.js";import{T as O,I as Q}from"./useResponsiveWidth-huLhTKBL.js";import"./last-IOi7af79.js";import"./Button-Y8r740D0.js";import"./useControlled-c04xw6hS.js";var U="[object String]";function G(s){return typeof s=="string"||!N(s)&&v(s)&&b(s)==U}function H(s,l){return k(l,function(a){return s[a]})}function P(s){return s==null?[]:H(s,D(s))}var W=Math.max;function Y(s,l,a,i){s=T(s)?s:P(s),a=a&&!i?_(a):0;var r=s.length;return a<0&&(a=W(r+a,0)),G(s)?a<=r&&s.indexOf(l,a)>-1:!!r&&R(s,l,a)>-1}function V(s){const l=s.slice();l.sort((i,r)=>{const c=new Date(i.createTime);return new Date(r.createTime).getTime()-c.getTime()});const a=new Map;return l.forEach(i=>{var x;const r=new Date(i.createTime),c=r.getFullYear(),o=r.getMonth()+1,n=Date.UTC(c,o-1,1);a.has(n)||a.set(n,[]),(x=a.get(n))==null||x.push(i)}),a}const le=()=>{const s=I(),l=z(),[a,i]=h.useState({searchQuery:""}),r=M(),[c,o]=h.useState([]),n=c.filter(t=>Y(t.filename,a.searchQuery)),x=V(n.filter(t=>t.memoId)),u=n.filter(t=>!t.memoId);h.useEffect(()=>{w.listResources({}).then(({resources:t})=>{o(t),l.setFinish(),Promise.all(t.map(d=>d.memoId?r.getOrFetchMemoById(d.memoId):null))})},[]);const g=()=>{F({title:"Delete all unused resources",content:"Are you sure to delete all unused resources? This action cannot be undone.",style:"warning",dialogName:"delete-unused-resources-dialog",onConfirm:async()=>{for(const t of u)await w.deleteResource({id:t.id});o(c.filter(t=>t.memoId))}})};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[e.jsx(L,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full shadow flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 text-black dark:text-gray-300",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(p.Paperclip,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:s("common.resources")})]}),e.jsx("div",{children:e.jsx(A,{className:"max-w-[8rem]",placeholder:s("common.search"),startDecorator:e.jsx(p.Search,{className:"w-4 h-auto"}),value:a.searchQuery,onChange:t=>i({...a,searchQuery:t.target.value})})})]}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-4 mb-6",children:l.isLoading?e.jsx("div",{className:"w-full h-32 flex flex-col justify-center items-center",children:e.jsx("p",{className:"w-full text-center text-base my-6 mt-8",children:s("resource.fetching-data")})}):e.jsx(e.Fragment,{children:n.length===0?e.jsxs("div",{className:"w-full mt-8 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(C,{}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:s("message.no-data")})]}):e.jsxs("div",{className:"w-full h-auto px-2 flex flex-col justify-start items-start gap-y-8",children:[Array.from(x.entries()).map(([t,d])=>{const j=new Date(t);return e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsxs("div",{className:"w-16 sm:w-24 pt-4 sm:pl-4 flex flex-col justify-start items-start",children:[e.jsx("span",{className:"text-sm opacity-60",children:j.getFullYear()}),e.jsx("span",{className:"font-medium text-xl",children:j.toLocaleString(S.language,{month:"short"})})]}),e.jsx("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:d.map(m=>{const f=m.memoId?r.getMemoById(m.memoId):null;return e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border dark:border-zinc-900 overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(y,{resource:m,strokeWidth:.5})}),e.jsxs("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:[e.jsx("p",{className:"text-xs shrink text-gray-400 truncate",children:m.filename}),f&&e.jsxs(E,{className:"shrink-0 text-xs ml-1 text-gray-400 hover:underline hover:text-blue-600",to:`/m/${f.name}`,target:"_blank",children:["#",f.id]})]})]},m.id)})})]},t)}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsx("div",{className:"w-16 sm:w-24 sm:pl-4 flex flex-col justify-start items-start"}),e.jsxs("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Unused resources"}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-500 opacity-80",children:["(",u.length,")"]}),e.jsx(O,{title:"Delete all",placement:"top",children:e.jsx(Q,{size:"sm",onClick:g,children:e.jsx(p.Trash,{className:"w-4 h-auto opacity-60"})})})]}),u.map(t=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border dark:border-zinc-900 overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(y,{resource:t,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-gray-400 truncate",children:t.filename})})]},t.id))]})]})]})]})})})]})})]})};export{le as default};
