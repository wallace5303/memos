import{u as T,a as B,b as F,c as _,r as l,j as e,d as D,g as O,e as R,n as j,f as q}from"./index-wLWO9-d2.js";import{L as G,A as H}from"./LocaleSelect-CC0qROH_.js";import{u as Q,I as w}from"./useLoading-1GM5JUMl.js";import{C as W}from"./Checkbox-4xG-yJfH.js";import{B as y}from"./Button-Y8r740D0.js";import{D as J}from"./Divider-PmcpRuGM.js";import"./Select-Gl6RUiyX.js";import"./createSvgIcon-LnoQSaos.js";import"./Typography-Ugz7CGU8.js";import"./useControlled-c04xw6hS.js";const ne=()=>{const t=T(),v=B(),o=F(),N=_(),a=Q(!1),{appearance:L,locale:S,systemStatus:r}=o.state,d=r.profile.mode,[i,u]=l.useState(""),[c,f]=l.useState(""),[x,b]=l.useState(!0),g=r.disablePasswordLogin,[h,C]=l.useState([]);l.useEffect(()=>{(async()=>{const{data:n}=await O();C(n)})()},[]),l.useEffect(()=>{d==="demo"&&(u("memos-demo"),f("secret"))},[d]);const I=s=>{const n=s.target.value;u(n)},k=s=>{const n=s.target.value;f(n)},U=s=>{o.setLocale(s)},P=s=>{o.setAppearance(s)},$=s=>{s.preventDefault(),p()},p=async()=>{if(!(i===""||c==="")&&!a.isLoading){try{a.setLoading();const{user:s}=await R.signIn({username:i,password:c,neverExpire:x});s?(await N.fetchCurrentUser(),v("/")):j.error(t("message.login-failed"))}catch(s){console.error(s),j.error(s.response.data.message||t("message.login-failed"))}a.setFinish()}},z=async s=>{const n=`auth.signin.${s.name}-${s.id}`;if(s.type==="OAUTH2"){const A=q("/auth/callback"),m=s.config.oauth2Config,E=`${m.authUrl}?client_id=${m.clientId}&redirect_uri=${A}&state=${n}&response_type=code&scope=${encodeURIComponent(m.scopes.join(" "))}`;window.location.href=E}};return e.jsxs("div",{className:"py-4 sm:py-8 w-80 max-w-full min-h-[100svh] mx-auto flex flex-col justify-start items-center",children:[e.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"w-full flex flex-row justify-center items-center mb-6",children:[e.jsx("img",{className:"h-14 w-auto rounded-full shadow",src:r.customizedProfile.logoUrl,alt:""}),e.jsx("p",{className:"ml-2 text-5xl text-black opacity-80 dark:text-gray-200",children:r.customizedProfile.name})]}),!g&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"w-full mt-2",onSubmit:$,children:[e.jsxs("div",{className:"flex flex-col justify-start items-start w-full gap-4",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start items-start gap-2",children:[e.jsx("span",{className:"leading-8 text-gray-600",children:t("common.username")}),e.jsx(w,{className:"w-full",size:"lg",type:"text",readOnly:a.isLoading,placeholder:t("common.username"),value:i,onChange:I,required:!0})]}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start gap-2",children:[e.jsx("span",{className:"leading-8 text-gray-600",children:t("common.password")}),e.jsx(w,{className:"w-full",size:"lg",type:"password",readOnly:a.isLoading,placeholder:t("common.password"),value:c,onChange:k,required:!0})]})]}),e.jsx("div",{className:"flex flex-row justify-start items-center w-full mt-6",children:e.jsx(W,{className:"dark:!text-gray-400",label:t("common.remember-me"),checked:x,onChange:s=>b(s.target.checked)})}),e.jsx("div",{className:"flex flex-row justify-end items-center w-full mt-6",children:e.jsx(y,{className:"w-full",size:"md",type:"submit",disabled:a.isLoading,loading:a.isLoading,onClick:p,children:t("common.sign-in")})})]}),r.allowSignUp&&e.jsxs("p",{className:"w-full mt-4 text-sm",children:[e.jsx("span",{className:"dark:text-gray-500",children:t("auth.sign-up-tip")}),e.jsx(D,{to:"/auth/signup",className:"cursor-pointer ml-2 text-blue-600 hover:underline",unstable_viewTransition:!0,children:t("common.sign-up")})]})]}),h.length>0&&e.jsxs(e.Fragment,{children:[!g&&e.jsx(J,{className:"!my-4",children:t("common.or")}),e.jsx("div",{className:"w-full flex flex-col space-y-2",children:h.map(s=>e.jsx(y,{variant:"outlined",color:"neutral",className:"w-full",size:"md",onClick:()=>z(s),children:t("common.sign-in-with",{provider:s.name})},s.id))})]})]}),e.jsxs("div",{className:"mt-4 flex flex-row items-center justify-center w-full gap-2",children:[e.jsx(G,{value:S,onChange:U}),e.jsx(H,{value:L,onChange:P})]})]})};export{ne as default};
