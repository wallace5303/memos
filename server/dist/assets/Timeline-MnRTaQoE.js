import{aC as T,j as e,u as C,i as $,k as O,l as E,r as y,m as I,I as w,au as _}from"./index-wLWO9-d2.js";import{c as h,T as z,u as A,I as L}from"./useResponsiveWidth-huLhTKBL.js";import{e as R,f as U,g as b,c as B}from"./useDebounce-KloUpVAw.js";import{E as F}from"./Empty-ltZlBdUA.js";import{M as P,c as J}from"./MemoView-Hb4REtig.js";import{u as W,M as q}from"./useFilterWithUrlParams-ebCQAYQq.js";import{M as Y}from"./MobileHeader-d_EUlUPT.js";import{D as Q,a as Z}from"./CommonDialog-ZOWzLRrT.js";import{D as G}from"./Divider-PmcpRuGM.js";import{B as H}from"./Button-Y8r740D0.js";import"./useControlled-c04xw6hS.js";import"./common-logcmh1j.js";import"./ResourceIcon-rz_9chuf.js";import"./useLoading-1GM5JUMl.js";import"./Checkbox-4xG-yJfH.js";import"./createSvgIcon-LnoQSaos.js";import"./Typography-Ugz7CGU8.js";import"./VisibilityIcon-nq_zBLTG.js";import"./useLocalStorage-fn64V-Iu.js";import"./Select-Gl6RUiyX.js";import"./Link-B2ydOwab.js";import"./last-IOi7af79.js";function V(t,o){for(var r,i=-1,n=t.length;++i<n;){var l=o(t[i]);l!==void 0&&(r=r===void 0?l:r+l)}return r}function K(t){return t&&t.length?V(t,T):0}const k=(t,o)=>{if(t===0)return"bg-gray-100 text-gray-400 dark:bg-gray-700 dark:text-gray-500";const r=t/o;return r>.7?"bg-blue-600 text-gray-100 dark:opacity-80":r>.4?"bg-blue-400 text-gray-200 dark:opacity-80":"bg-blue-300 text-gray-600 dark:opacity-80"},X=t=>{const{month:o,data:r,onClick:i}=t,n=new Date(o).getUTCFullYear(),l=new Date(o).getUTCMonth()+1,p=new Date(n,l,0).getDate(),d=new Date(n,l-1,1).getDay(),j=new Date(n,l-1,p).getDay(),N=Math.max(...Object.values(r)),g=[];for(let s=0;s<d;s++)g.push(0);for(let s=1;s<=p;s++)g.push(s);for(let s=0;s<6-j;s++)g.push(0);return e.jsx("div",{className:h("w-36 h-auto p-0.5 shrink-0 grid grid-cols-7 grid-flow-row gap-1"),children:g.map((s,x)=>{const c=R(U(`${n}-${String(l).padStart(2,"0")}-${String(s).padStart(2,"0")}`)),f=r[c]||0,v=new Date().toDateString()===new Date(c).toDateString(),S=f?`${f} memos in ${c}`:c;return s?e.jsx(z,{className:"shrink-0",title:S,placement:"top",arrow:!0,children:e.jsx("div",{className:h("w-4 h-4 text-[9px] rounded-md flex justify-center items-center border border-transparent",k(f,N),v&&"border-gray-600 dark:!border-gray-500"),onClick:()=>f&&i&&i(c),children:s})},`${c}-${x}`):e.jsx("div",{className:h("shrink-0 opacity-30 w-4 h-4 rounded-md flex justify-center items-center border border-transparent",k(f,N))},`${c}-${x}`)})})},ee=(t,o)=>{const r=[];return Object.entries(t).forEach(([i,n])=>{const l=i.split("-").slice(0,2).join("-"),p=r.find(d=>d.month===l);if(p)p.data[i]=n;else{const d=o.filter(j=>B(j.displayTime).startsWith(l));r.push({month:l,data:{[i]:n},memos:d})}}),r.filter(i=>i.memos.length>0).sort((i,n)=>b(n.month)-b(i.month))},ve=()=>{const t=C(),{md:o}=A(),r=$(),i=O(),n=E(),[l,p]=y.useState({}),[d,j]=y.useState(),[N,g]=y.useState(!0),s=y.useRef(void 0),{tag:x,text:c}=W(),f=n.value.sort((a,m)=>b(m.displayTime)-b(a.displayTime)),v=ee(l,f);y.useEffect(()=>{s.current=void 0,n.reset(),S()},[d,x,c]),y.useEffect(()=>{(async()=>{const a=['row_status == "NORMAL"'],m=[];x&&m.push(JSON.stringify(`#${x}`)),c&&m.push(JSON.stringify(c)),m.length>0&&a.push(`content_search == [${m.join(", ")}]`);const{stats:u}=await I.getUserMemosStats({name:r.name,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,filter:a.join(" && ")});p(u)})()},[f.length]);const S=async()=>{const a=[`creator == "${r.name}"`,'row_status == "NORMAL"'],m=[];if(x&&m.push(JSON.stringify(`#${x}`)),c&&m.push(JSON.stringify(c)),m.length>0&&a.push(`content_search == [${m.join(", ")}]`),d){const D=b(d)+new Date().getTimezoneOffset()*60*1e3;a.push(`display_time_after == ${D/1e3}`,`display_time_before == ${(D+Z)/1e3}`)}g(!0);const u=await i.fetchMemos({pageSize:Q,filter:a.join(" && "),pageToken:s.current});g(!1),s.current=u.nextPageToken},M=()=>{J({})};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[e.jsx(Y,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full shadow flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 text-black dark:text-gray-300",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsx("div",{children:e.jsxs("div",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",onClick:()=>j(void 0),children:[e.jsx(w.GanttChartSquare,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:t("timeline.title")})]})}),e.jsx("div",{className:"flex justify-end items-center gap-2",children:e.jsx(L,{variant:"outlined",size:"sm",onClick:()=>M(),children:e.jsx(w.Plus,{className:"w-5 h-auto"})})})]}),e.jsxs("div",{className:"w-full h-auto flex flex-col justify-start items-start",children:[e.jsx(q,{className:"px-2 my-4"}),v.map((a,m)=>e.jsxs(y.Fragment,{children:[e.jsxs("div",{className:h("flex justify-start items-start w-full mt-2 last:mb-4",o?"flex-row":"flex-col"),children:[e.jsxs("div",{className:h("flex shrink-0",o?"flex-col w-40 pr-4 pl-2 pb-8":"flex-row w-full pl-1 mt-2 mb-2"),children:[e.jsxs("div",{className:h("w-full flex flex-col",o&&"mt-4 mb-2"),children:[e.jsx("span",{className:"font-medium text-3xl leading-none mb-1",children:new Date(a.month).toLocaleString(_.language,{month:"short",timeZone:"UTC"})}),e.jsx("span",{className:"opacity-60",children:new Date(a.month).getUTCFullYear()}),e.jsxs("span",{className:"text-xs opacity-40",children:["Total: ",K(Object.values(a.data))]})]}),e.jsx(X,{month:a.month,data:a.data,onClick:u=>j(u)})]}),e.jsx("div",{className:h("flex flex-col justify-start items-start",o?"w-[calc(100%-8rem)]":"w-full"),children:a.memos.map((u,D)=>e.jsxs("div",{className:h("relative w-full flex flex-col justify-start items-start pl-4 sm:pl-10 pt-0"),children:[e.jsx(P,{className:"!border !border-gray-100 dark:!border-zinc-700",memo:u}),a.memos.length>1&&e.jsxs("div",{className:"absolute -left-2 sm:left-2 top-4 h-full",children:[D!==a.memos.length-1&&e.jsx("div",{className:"absolute top-2 left-[7px] h-full w-0.5 bg-gray-200 dark:bg-gray-700 block"}),e.jsx("div",{className:"border-4 rounded-full border-white relative dark:border-zinc-800",children:e.jsx(w.Circle,{className:"w-2 h-auto bg-gray-200 text-gray-200 dark:bg-gray-700 dark:text-gray-700 rounded-full"})})]})]},`${u.id}-${u.displayTime}`))})]}),m!==v.length-1&&e.jsx(G,{className:"w-full !my-4 md:!mb-8 !bg-gray-100 dark:!bg-zinc-700"})]},a.month)),N?e.jsxs("div",{className:"flex flex-row justify-center items-center w-full my-4 text-gray-400",children:[e.jsx(w.Loader,{className:"w-4 h-auto animate-spin mr-1"}),e.jsx("p",{className:"text-sm italic",children:t("memo.fetching-data")})]}):s.current?e.jsx("div",{className:"w-full flex flex-row justify-center items-center my-4",children:e.jsx(H,{variant:"plain",endDecorator:e.jsx(w.ArrowDown,{className:"w-5 h-auto"}),onClick:S,children:t("memo.fetch-more")})}):f.length===0&&e.jsxs("div",{className:"w-full mt-12 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(F,{}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:t("message.no-data")})]})]})]})})]})};export{ve as default};
