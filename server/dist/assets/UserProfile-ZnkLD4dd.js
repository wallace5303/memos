import{u as M,p as S,c as U,r as a,k as b,l as k,n as T,j as e,I as l}from"./index-wLWO9-d2.js";import{E}from"./Empty-ltZlBdUA.js";import{u as R,M as L}from"./useFilterWithUrlParams-ebCQAYQq.js";import{M as _}from"./MemoView-Hb4REtig.js";import{M as D}from"./MobileHeader-d_EUlUPT.js";import{U as F}from"./useResponsiveWidth-huLhTKBL.js";import{D as I}from"./CommonDialog-ZOWzLRrT.js";import{g as h}from"./useDebounce-KloUpVAw.js";import{u as P}from"./useLoading-1GM5JUMl.js";import{B as j}from"./Button-Y8r740D0.js";import"./common-logcmh1j.js";import"./VisibilityIcon-nq_zBLTG.js";import"./Typography-Ugz7CGU8.js";import"./useLocalStorage-fn64V-Iu.js";import"./Select-Gl6RUiyX.js";import"./createSvgIcon-LnoQSaos.js";import"./useControlled-c04xw6hS.js";import"./Checkbox-4xG-yJfH.js";import"./Link-B2ydOwab.js";import"./ResourceIcon-rz_9chuf.js";import"./Divider-PmcpRuGM.js";import"./last-IOi7af79.js";const oe=()=>{const o=M(),c=S(),y=U(),f=P(),[t,g]=a.useState(),w=b(),u=k(),[N,p]=a.useState(!0),i=a.useRef(void 0),{tag:n,text:m}=R(),x=u.value.sort((s,r)=>h(r.displayTime)-h(s.displayTime)).sort((s,r)=>Number(r.pinned)-Number(s.pinned));a.useEffect(()=>{const s=c.username;if(!s)throw new Error("username is required");y.getOrFetchUserByUsername(s).then(r=>{g(r),f.setFinish()}).catch(r=>{console.error(r),T.error(o("message.user-not-found"))})},[c.username]),a.useEffect(()=>{t&&(i.current=void 0,u.reset(),d())},[t,n,m]);const d=async()=>{if(!t)return;const s=[`creator == "${t.name}"`,'row_status == "NORMAL"',"order_by_pinned == true"],r=[];n&&r.push(JSON.stringify(`#${n}`)),m&&r.push(JSON.stringify(m)),r.length>0&&s.push(`content_search == [${r.join(", ")}]`),p(!0);const v=await w.fetchMemos({pageSize:I,filter:s.join(" && "),pageToken:i.current});p(!1),i.current=v.nextPageToken};return e.jsxs("section",{className:"w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[e.jsx(D,{}),e.jsx("div",{className:"w-full px-4 sm:px-6 flex flex-col justify-start items-center",children:!f.isLoading&&(t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative -mt-6 top-8 w-full flex justify-end items-center",children:e.jsx("a",{className:"",href:`/u/${encodeURIComponent(t==null?void 0:t.username)}/rss.xml`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(j,{color:"neutral",variant:"outlined",endDecorator:e.jsx(l.Rss,{className:"w-4 h-auto opacity-60"}),children:"RSS"})})}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-center py-8",children:[e.jsx(F,{className:"!w-20 !h-20 mb-2 drop-shadow",avatarUrl:t==null?void 0:t.avatarUrl}),e.jsx("div",{className:"w-full flex flex-row justify-center items-center",children:e.jsx("p",{className:"text-3xl text-black leading-none opacity-80 dark:text-gray-200",children:t==null?void 0:t.nickname})})]}),e.jsx(L,{className:"px-2 pb-3"}),x.map(s=>e.jsx(_,{memo:s,showVisibility:!0,showPinned:!0},`${s.id}-${s.displayTime}`)),N?e.jsxs("div",{className:"flex flex-row justify-center items-center w-full my-4 text-gray-400",children:[e.jsx(l.Loader,{className:"w-4 h-auto animate-spin mr-1"}),e.jsx("p",{className:"text-sm italic",children:o("memo.fetching-data")})]}):i.current?e.jsx("div",{className:"w-full flex flex-row justify-center items-center my-4",children:e.jsx(j,{variant:"plain",endDecorator:e.jsx(l.ArrowDown,{className:"w-5 h-auto"}),onClick:d,children:o("memo.fetch-more")})}):x.length===0&&e.jsxs("div",{className:"w-full mt-12 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(E,{}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:o("message.no-data")})]})]}):e.jsx("p",{children:"Not found"}))})]})};export{oe as default};
